"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}(function(){function b(d,e,g){function a(j,i){if(!e[j]){if(!d[j]){var f="function"==typeof require&&require;if(!i&&f)return f(j,!0);if(h)return h(j,!0);var c=new Error("Cannot find module '"+j+"'");throw c.code="MODULE_NOT_FOUND",c}var k=e[j]={exports:{}};d[j][0].call(k.exports,function(b){var c=d[j][1][b];return a(c||b)},k,k.exports,b,d,e,g)}return e[j].exports}for(var h="function"==typeof require&&require,c=0;c<g.length;c++)a(g[c]);return a}return b})()({1:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=a("./router"),f=(a,b,c)=>{var d=a.querySelector(b);d&&(d.innerHTML=c)};new d.default().onNavigate(a=>f(a.element,".params",JSON.stringify(a.params))).onError(a=>a.router.reveal("/error").then(a=>f(a.element,"code",document.location.hash))).start(),console.log("hello world from watchify")},{"./router":2}],2:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.default=class a{constructor(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this.hashChar="#",this.onErrorHandler=a=>{throw new Error("Unknown route: ".concat(a.hashChangedEvent.newURL))},this.onBeforeNavigateHandler=()=>{},this.onBeforeLeaveHandler=()=>{},this.onNavigateHandler=()=>{},this.onLeaveHandler=()=>{},console.log("hello world from watchify router"),a=Object.assign({element:document.body,hashChar:"#",test:a=>/^[A-Za-z0-9_@()/.-]*$/.test(a)},a),this.hashChar=a.hashChar,this.routes={};for(var f of a.element.querySelectorAll("[data-route]")){var e=f,g=e.dataset.route;if(!a.test(g))throw new Error("Invalid route definition: ".concat(g));if(!g.startsWith("/"))throw new Error("Invalid route definition: ".concat(g));var b={},c=null,d=e.dataset.routeParams;if(!d)c=new Map;else try{b=JSON.parse(d),c=new Map(Object.entries(b))}catch(a){console.error("Couldn't deserialize default params for route ".concat(g,": ").concat(a,".\nMake sure that \"").concat(d,"\" is valid JSON..."))}var h=e.dataset.routeTemplateUrl;h||(h=null),this.routes[g]={route:g,element:e,defaultParams:b,paramMap:c,params:{},templateUrl:h}}}start(){return window.addEventListener("hashchange",a=>this.onHashChange(a)),window.dispatchEvent(new HashChangeEvent("hashchange")),this}onError(a){return this.onErrorHandler=a,this}onNavigate(a){return this.onNavigateHandler=a,this}onLeave(a){return this.onLeaveHandler=a,this}onBeforeNavigate(a){return this.onBeforeNavigateHandler=a,this}onBeforeLeave(a){return this.onBeforeLeaveHandler=a,this}navigate(a){return document.location.hash=this.hashChar+a,this}reveal(a){return this.revealUri(a,null)}onHashChange(a){var b=document.location.hash;b&&a.newURL&&(b=a.newURL.replace(document.location.origin+document.location.pathname,"")),b=b.replace(document.location.search,""),this.revealUri(b.replace(this.hashChar,""),a)}revealUri(a,b){var c=this;return _asyncToGenerator(function*(){var d,e,f,g,h,j=a.split("/").map(a=>decodeURIComponent(a)),k="";for(f=0,g=j.length;f<g;f++){var u=j[f];k=k.endsWith("/")?k+u:k+"/"+u,e=c.routes[k],(e&&!d||e&&d.route.length<e.route.length)&&(d=e,h=f+1)}var l;if(c.current){var v=c.buildRouteEventArgs(c.current,b);if(l=c.onBeforeLeaveHandler(v),!1==l)return;if(l instanceof Promise&&(l=yield l,!1==l))return;if(c.current.element.style.display="none",l=c.onLeaveHandler(v),!1==l)return;if(l instanceof Promise&&(l=yield l,!1==l))return}""===j[j.length-1]&&j.splice(-1,1);var m=j.slice(h);if(d)if(m.length>d.paramMap.size)d=null;else if(d.params=Object.assign({},d.defaultParams),d.paramMap=new Map(Object.entries(d.params)),m.length){var w=Array.from(d.paramMap.keys());for(f=0,g=m.length;f<g;f++){var n=m[f],o=w[f];d.paramMap.set(o,n),d.params[o]=n}}if(d){c.current=d;var x=c.buildRouteEventArgs(c.current,b);if(l=c.onBeforeNavigateHandler(x),!1==l)return;if(l instanceof Promise&&(l=yield l,!1==l))return;if(d.templateUrl){var p,q=[],r=0,s=Array.from(d.paramMap.values());for(var y of d.templateUrl.split(/{/))p=y.indexOf("}"),-1==p?q.push(y):q.push(s[r++]+y.substring(p+1,y.length));var z=yield fetch(q.join(""),{method:"get"});z.ok||c.onErrorHandler(x),d.element.innerHTML=yield z.text()}return c.current.element.style.display="contents",l=c.onNavigateHandler(x),l instanceof Promise&&(yield l),x}c.current=null;var t=c.buildRouteEventArgs(null,b);return c.onErrorHandler(t),t})()}buildRouteEventArgs(a,b){return{route:null==a?null:a.route,params:null==a?null:a.params,router:this,element:null==a?null:a.element,hashChangedEvent:b}}}},{}]},{},[1]);
